# Polymarket Crypto Edge Research

**Production-grade, self-improving ML + Grok 4.1 research stack for:**
1. 15-minute directional predictions on BTC/ETH/SOL
2. Last-seconds Polymarket scalping with microstructure edge
3. Cross-market arbitrage detection

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CEX Client   â”‚ â”‚ Polymarket   â”‚ â”‚ Storage (SQLite+Parquet) â”‚ â”‚
â”‚  â”‚ (Binance WS) â”‚ â”‚ Gamma/CLOB   â”‚ â”‚                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FEATURE LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Underlyings  â”‚ â”‚ Microstructureâ”‚ â”‚Cross-Marketâ”‚ â”‚ Grok 4.1  â”‚ â”‚
â”‚  â”‚ (TA/Vol/Mom) â”‚ â”‚ (Book/Flow)  â”‚ â”‚ (Arb/Corr) â”‚ â”‚ (Regime)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ML LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ LightGBM     â”‚ â”‚ Ridge/Lasso  â”‚ â”‚ LSTM Sequence Models     â”‚ â”‚
â”‚  â”‚ Ensemble     â”‚ â”‚ Linear       â”‚ â”‚                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚                                        â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                   â”‚ Calibrationâ”‚                                 â”‚
â”‚                   â”‚ (Isotonic) â”‚                                 â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STRATEGY LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 15m Directionâ”‚ â”‚ Last-Seconds â”‚ â”‚ Cross-Market Arb         â”‚ â”‚
â”‚  â”‚ Policy       â”‚ â”‚ Scalper      â”‚ â”‚ (Sumâ‰ 1, Semantic Match)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚                                        â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                   â”‚Risk Managerâ”‚                                 â”‚
â”‚                   â”‚(Kelly+Corr)â”‚                                 â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       EXECUTION LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Paper Trader â”‚ â”‚ Backtester   â”‚ â”‚ Live Orchestrator        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Quick Start

```bash
# 1. Clone and setup
cd polymarket_crypto_edge_research
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 2. Configure
cp config.example.env .env
# Edit .env with your API keys

# 3. Sanity check
python -m examples.sanity_check_ingestion

# 4. Run paper trading
python -m scripts.run_live_paper

# 5. Daily retrain (run via cron at 4 AM UTC)
python -m scripts.daily_retrain
```

## ğŸ“Š Key Features

### 15-Minute Direction Predictions
- **Features**: 40+ technical indicators, volatility metrics, funding rates
- **Models**: LightGBM ensemble + Ridge + LSTM
- **Labels**: Ternary (UP/FLAT/DOWN) with 0.08% threshold
- **Grok Enhancement**: Regime detection (risk-on/risk-off/choppy)

### Last-Seconds Polymarket Scalper
- **Horizon**: Markets resolving in <60 minutes
- **Edge**: ML probability vs implied probability
- **Execution**: Simulate realistic fills from orderbook depth
- **Risk**: Kelly-capped sizing with correlation clustering

### Cross-Market Arbitrage
- **Sumâ‰ 1 Detection**: Find mutually exclusive outcomes not summing to 1.00
- **Semantic Matching**: Grok-powered clustering of equivalent markets
- **Execution**: Simultaneous paper orders on arbitrage legs

### Grok 4.1 Integration
- **Usage**: Regime detection, sentiment scoring, semantic clustering
- **Efficiency**: Batched calls every 15-30 min, <1200 input tokens
- **Output**: Strict JSON with fallback parsing

## ğŸ“ Directory Structure

```
polymarket_crypto_edge_research/
â”œâ”€â”€ core/           # Config, logging, time utilities
â”œâ”€â”€ data/           # API clients, storage, rate limiting
â”œâ”€â”€ features/       # Feature engineering for all data sources
â”œâ”€â”€ ml/             # Models, training, calibration, registry
â”œâ”€â”€ llm/            # Grok 4.1 client and regime classifier
â”œâ”€â”€ strategy/       # Trading policies and risk management
â”œâ”€â”€ exec/           # Paper trading, backtesting, orchestration
â”œâ”€â”€ reports/        # Metrics and visualization
â”œâ”€â”€ scripts/        # Daily retrain, live paper trading
â””â”€â”€ examples/       # Sanity check scripts
```

## âš™ï¸ Configuration

All config via `.env` file:

| Variable | Description | Default |
|----------|-------------|---------|
| `XAI_API_KEY` | xAI API key for Grok 4.1 | Required |
| `PAPER_TRADING` | Enable paper trading mode | `true` |
| `INITIAL_CAPITAL` | Starting paper capital | `10000.0` |
| `KELLY_FRACTION` | Kelly criterion fraction | `0.25` |
| `MIN_EDGE_THRESHOLD` | Minimum edge to trade | `0.02` |
| `DIRECTION_THRESHOLD_PCT` | UP/DOWN classification threshold | `0.08` |

## ğŸ“ˆ Performance Metrics

The system tracks:
- **Sharpe Ratio**: Risk-adjusted returns
- **Win Rate**: % of profitable trades
- **Max Drawdown**: Largest peak-to-trough decline
- **Calmar Ratio**: Return / Max Drawdown
- **Hit Rate by Strategy**: Per-strategy performance

## ğŸ”„ Daily Retraining

The `daily_retrain.py` script:
1. Trains 4-6 candidate models on latest data
2. Runs full backtest on hold-out period
3. Promotes to champion only if:
   - Sharpe > current champion + 0.3
   - Max DD not worse than champion

## ğŸ›¡ï¸ Risk Management

- **Position Sizing**: Kelly criterion with configurable fraction
- **Correlation Limits**: Max correlation between positions
- **Daily Loss Limit**: Auto-stop at configurable daily loss
- **Max Drawdown**: System halt if drawdown exceeds limit

## ğŸ“ License

MIT License - See LICENSE file for details.
